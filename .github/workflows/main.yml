name: Make MemReduct EXE

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    # 1. 소스 코드 가져오기
    - name: Checkout MemReduct
      uses: actions/checkout@v4
      with:
        path: memreduct

    # 2. 라이브러리 가져오기
    - name: Checkout Routine Library
      uses: actions/checkout@v4
      with:
        repository: henrypp/routine
        path: routine

    # 3. MSBuild 설정
    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1

    # 4. 컴파일 실행 (수정된 부분)
    # v145 대신 현재 서버에 깔려있는 v143을 강제로 사용하도록 명령을 추가했습니다.
    - name: Build Solution
      run: |
        cd memreduct
        msbuild memreduct.sln -property:Configuration=Release -property:Platform=x64 -property:PlatformToolset=v143

    # 5. 결과물 업로드
    - name: Upload EXE
      uses: actions/upload-artifact@v4
      with:
        name: memreduct_result
        path: memreduct/bin/64/memreduct.exe
