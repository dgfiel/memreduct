name: Make MemReduct EXE

on:
  workflow_dispatch:

jobs:
  build:
    # 1. 호환성을 위해 Windows 2019 환경 유지
    runs-on: windows-2019
    
    steps:
    - name: Checkout MemReduct
      uses: actions/checkout@v4
      with:
        path: memreduct

    - name: Checkout Routine Library
      uses: actions/checkout@v4
      with:
        repository: henrypp/routine
        path: routine

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1

    # 2. 컴파일 실행 (여기가 핵심 수정됨)
    # -p:PlatformToolset=v142 : 2019년 도구 사용
    # -p:TreatWarningsAsErrors=false : 경고 무시
    # -p:LanguageStandard_C=stdc17 : "stdclatest" 대신 "C17" 표준을 강제로 사용
    - name: Build Solution
      run: |
        cd memreduct
        msbuild memreduct.sln -p:Configuration=Release -p:Platform=x64 -p:PlatformToolset=v142 -p:TreatWarningsAsErrors=false -p:LanguageStandard_C=stdc17

    - name: Upload EXE
      uses: actions/upload-artifact@v4
      with:
        name: memreduct_result
        path: memreduct/bin/64/memreduct.exe
