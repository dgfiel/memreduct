name: Make MemReduct EXE

on:
  workflow_dispatch:

jobs:
  build:
    # 1. 최신(2022) 대신 조금 더 호환성이 좋은 Windows 2019 환경을 사용합니다.
    runs-on: windows-2019
    
    steps:
    - name: Checkout MemReduct
      uses: actions/checkout@v4
      with:
        path: memreduct

    - name: Checkout Routine Library
      uses: actions/checkout@v4
      with:
        repository: henrypp/routine
        path: routine

    - name: Setup MSBuild
      uses: microsoft/setup-msbuild@v1

    # 2. 컴파일 실행 (핵심 수정)
    # -p:PlatformToolset=v142 : VS2019용 도구 사용
    # -p:TreatWarningsAsErrors=false : 경고가 떠도 에러로 처리하지 않음 (무시)
    - name: Build Solution
      run: |
        cd memreduct
        msbuild memreduct.sln -p:Configuration=Release -p:Platform=x64 -p:PlatformToolset=v142 -p:TreatWarningsAsErrors=false

    - name: Upload EXE
      uses: actions/upload-artifact@v4
      with:
        name: memreduct_result
        path: memreduct/bin/64/memreduct.exe
